(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{204:function(e,t,a){e.exports=a(432)},209:function(e,t,a){},212:function(e,t,a){},432:function(e,t,a){"use strict";a.r(t);var n=a(1),c=a.n(n),r=a(66),o=a.n(r),i=(a(209),a(32)),s=a(99),l=a.n(s),m=a(162),u=a(102),d=a(10),p=a(11),f=a(13),h=a(12),g=a(14),v=a(434),b=a(433),y=(a(212),a(213),"outcome"),E=function(e){return e<10?"0"+e:e},N=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=[],n=0;n<e;n++)a[n]=t+n;return a},C=function(e){var t=e?new Date(e):new Date;return{year:t.getFullYear(),month:E(t.getMonth()+1)}},O=function(e){if(!e.match(/^\d{4}-\d{2}-\d{2}$/))return!1;var t=new Date(e);return!Number.isNaN(t.getTime())&&t.toISOString().slice(0,10)===e},k=function(e){return e.reduce(function(e,t){return e[t.id]=t,e},{})},j=function(){return"_"+Math.random().toString(36).substr(2,9)},w={blue:"#347eff",deepBlue:"#61dafb",green:"#28a745",red:"#dc3545",gray:"#555",lightGray:"#efefef",white:"#fff"},x=a(17),S=a.n(x),I=a(15),D=a.n(I),M=a(435),P=function(e){return function(t){return c.a.createElement(ae.Consumer,null,function(a){var n=a.state,r=a.actions;return c.a.createElement(e,Object.assign({},t,{data:n,actions:r}))})}},T=a(45),z=Object.keys(w).map(function(e){return w[e]}),F=function(e){var t=e.title,a=e.categoryData;return 0===a.length?c.a.createElement("h6",{className:"text-center mt-3"},t,"\u8fd8\u6ca1\u6709\u4efb\u4f55\u6570\u636e"):c.a.createElement("div",{className:"pie-chart-com"},c.a.createElement("h6",{className:"text-center mt-3"},t),c.a.createElement(T.d,{width:"100%",height:300},c.a.createElement(T.c,null,c.a.createElement(T.b,{isAnimationActive:!1,data:a,dataKey:"value",cx:"50%",cy:"50%",outerRadius:100,fill:w.blue},a.map(function(e,t){return c.a.createElement(T.a,{key:t,fill:z[t%z.length]})})),c.a.createElement(T.e,null))))},L=function(e){var t=e.items,a=e.onModifyItem,n=e.onDeleteItem;return c.a.createElement("ul",{className:"my-2 p-0"},t.map(function(e){return c.a.createElement("li",{className:"list-group-item d-flex\r justify-content-between align-items-center",key:e.id},c.a.createElement("span",{className:"col-1"},c.a.createElement(D.a,{className:"rounded-circle",fontSize:"30px",style:{backgroundColor:"#007bff",padding:"3px"},color:"#fff",icon:e.category.iconName})),c.a.createElement("span",{className:"col-5"},e.title),c.a.createElement("span",{className:"col-2 font-weight-bold"},"income"===e.category.type?"+":"-",e.price,"\u5143"),c.a.createElement("span",{className:"col-2"},e.date),c.a.createElement("a",{className:"col-1",href:"#",onClick:function(){a(e)}},c.a.createElement(D.a,{className:"rounded-circle",fontSize:"30px",style:{backgroundColor:"#28a745",padding:"3px"},color:"#fff",icon:"ios-create-outline"})),c.a.createElement("a",{className:"col-1",href:"#",onClick:function(){n(e)}},c.a.createElement(D.a,{className:"rounded-circle",fontSize:"30px",style:{backgroundColor:"#dc3545",padding:"1px"},color:"#fff",icon:"ios-close"})))}))};L.defaultProps={onModifyItem:function(){}};var V=L,Y=function(e){var t=e.income,a=e.outcome;return c.a.createElement("div",{className:"total-price-com text-left pr-3",style:{color:"#fff"}},c.a.createElement("div",{className:"outcome mb-1"},"\u603b\u652f\u51fa\uff1a",c.a.createElement("span",{className:"font-weight-bold"},a)),c.a.createElement("div",{className:"income"},"\u603b\u6536\u5165\uff1a",c.a.createElement("span",{className:"font-weight-bold"},t)))},_=a(2),A=a.n(_),R=function(e){function t(e){var a;return Object(d.a)(this,t),(a=Object(f.a)(this,Object(h.a)(t).call(this,e))).handleClick=function(e){a.node.contains(e.target)||a.setState({isOpen:!1})},a.toggleDropdown=function(e){e.preventDefault(),a.setState({isOpen:!a.state.isOpen})},a.selectYear=function(e,t){e.preventDefault(),a.setState({selectedYear:t})},a.selectMonth=function(e,t){e.preventDefault(),a.setState({isOpen:!1,selectedMonth:t}),a.props.onChange(a.state.selectedYear,t)},a.state={isOpen:!1,selectedYear:a.props.year,selectedMonth:a.props.month},a}return Object(g.a)(t,e),Object(p.a)(t,[{key:"componentDidMount",value:function(){document.addEventListener("click",this.handleClick,!1)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("click",this.handleClick,!1)}},{key:"render",value:function(){var e=this,t=this.props.year,a=this.state.selectedYear,n=this.state.selectedMonth,r=this.state.isOpen,o=N(12,1).map(function(e){return E(e)}),i=N(9,-4).map(function(e){return e+t}),s=this.state.selectedYear;return c.a.createElement("div",{className:"month-picker-com dropdown text-left",ref:function(t){e.node=t}},c.a.createElement("button",{className:"btn btn-lg btn-light dropdown-toggle",id:"month-picker-dropdown-btn",onClick:this.toggleDropdown},"".concat(a,"\u5e74 ").concat(n,"\u6708")),r&&c.a.createElement("div",{className:"dropdown-menu",style:{display:"block"},role:"menu","aria-labelledby":"month-picker-dropdown-btn"},c.a.createElement("div",{className:"row"},c.a.createElement("div",{className:"years-range col border-right"},i.map(function(t,a){return c.a.createElement("a",{key:a,href:"#",className:t===s?"dropdown-item active":"dropdown-item",onClick:function(a){return e.selectYear(a,t)}},t,"\u5e74")})),c.a.createElement("div",{className:"month-range col"},o.map(function(t,a){return c.a.createElement("a",{key:a,href:"#",className:t===n?"dropdown-item active":"dropdown-item",onClick:function(a){e.selectMonth(a,t)}},t,"\u6708")})))))}}]),t}(c.a.Component);R.propsTypes={year:A.a.number.isRequired,month:A.a.number.isRequired,onChange:A.a.func.isRequired};var q=R,B=function(e){var t=e.onClick;return c.a.createElement("button",{className:"btn btn-primary btn-block d-flex justify-content-center align-items-center",onClick:function(e){t()}},c.a.createElement(D.a,{className:"rounded-circle",fontSize:"30px",color:"#fff",icon:"ios-add-circle"}),"\u521b\u5efa\u4e00\u6761\u65b0\u7684\u8bb0\u8d26\u8bb0\u5f55")},W=function(e){function t(e){var a;return Object(d.a)(this,t),(a=Object(f.a)(this,Object(h.a)(t).call(this,e))).tabChange=function(e,t){e.preventDefault(),a.setState({activeIndex:t}),a.props.onTabChange(t)},a.activeClassName=function(e,t){return e===t?"nav-link active":"nav-link"},a.state={activeIndex:e.activeIndex},a}return Object(g.a)(t,e),Object(p.a)(t,[{key:"render",value:function(){var e=this,t=this.props.children,a=this.state.activeIndex;return c.a.createElement("ul",{className:"nav nav-tabs nav-fill my-4"},c.a.Children.map(t,function(t,n){return c.a.createElement("li",{className:"nav-item"},c.a.createElement("a",{onClick:function(t){e.tabChange(t,n)},href:"#",className:e.activeClassName(a,n),role:"button"},t))}))}}]),t}(c.a.Component),J=function(e){var t=e.children;return c.a.createElement(c.a.Fragment,null,t)},$=function(){return c.a.createElement("div",{className:"loading-com text-center"},c.a.createElement(D.a,{icon:"ios-refresh",fontSize:"40px",color:"#347eff",rotate:!0}),c.a.createElement("h5",null,"\u52a0\u8f7d\u4e2d"))},G=["list","chart"],K=function(e,t){var a={};return e.filter(function(e){return e.category.type===t}).forEach(function(e){a[e.cid]?(a[e.cid].value+=1*e.price,a[e.cid].items.push(e.id)):a[e.cid]={name:e.category.name,value:1*e.price,items:[e.id]}}),Object.keys(a).map(function(e){return Object(i.a)({},a[e])})},U=function(e){function t(e){var a;return Object(d.a)(this,t),(a=Object(f.a)(this,Object(h.a)(t).call(this,e))).changeView=function(e){a.setState({tabView:G[e]})},a.changeDate=function(e,t){a.props.actions.selectNewDate(e,t)},a.modifyItem=function(e){a.props.history.push("/edit/".concat(e.id))},a.createItem=function(){a.props.history.push("/create")},a.deleteItem=function(e){a.props.actions.deleteItem(e)},a.state={tabView:G[0]},a}return Object(g.a)(t,e),Object(p.a)(t,[{key:"componentDidMount",value:function(){this.props.actions.getInitalData()}},{key:"render",value:function(){var e=this.props.data,t=e.items,a=e.categories,n=e.currentDate,r=e.isLoading,o=this.state.tabView,i=Object.keys(t).map(function(e){return t[e].category=a[t[e].cid],t[e]}),s=K(i,y),l=K(i,"income"),m=G.findIndex(function(e){return e===o}),u=0,d=0;return i.forEach(function(e){e.category.type===y?d+=e.price:u+=e.price}),c.a.createElement("div",{className:"create-page rounded"},c.a.createElement("header",{className:"header"},c.a.createElement("div",{className:"row py-4",style:{background:"#aaa"}},c.a.createElement(D.a,{className:"col",icon:"ios-ionic",color:"#fff",fontSize:"100px"})),c.a.createElement("div",{className:"row py-3",style:{background:"#aaa"}},c.a.createElement("div",{className:"col-9"},c.a.createElement(q,{year:n.year,month:n.month,onChange:this.changeDate})),c.a.createElement("div",{className:"col-3"},c.a.createElement(Y,{income:u,outcome:d})))),c.a.createElement("div",{className:"content-area"},c.a.createElement(W,{activeIndex:m,onTabChange:this.changeView},c.a.createElement(J,null,c.a.createElement(D.a,{className:"rounded-circle mr-2",fontSize:"30px",color:"#007bff",icon:"ios-paper"}),"\u5217\u8868\u6a21\u5f0f"),c.a.createElement(J,null,c.a.createElement(D.a,{className:"rounded-circle mr-2",fontSize:"30px",color:"#007bff",icon:"ios-pie"}),"\u56fe\u8868\u6a21\u5f0f")),c.a.createElement(B,{onClick:this.createItem}),r&&c.a.createElement($,null),0===i.length&&!r&&c.a.createElement("div",{className:"small mt-3"},"\u4f60\u8fd8\u6ca1\u6709\u4efb\u4f55\u8bb0\u8d26\u8bb0\u5f55"),"list"===o&&c.a.createElement(V,{onModifyItem:this.modifyItem,items:i,onDeleteItem:this.deleteItem}),"chart"===o&&c.a.createElement(c.a.Fragment,null,c.a.createElement("div",{className:"row"},c.a.createElement("div",{className:"col"},c.a.createElement(F,{title:"\u672c\u6708\u652f\u51fa",categoryData:s})),c.a.createElement("div",{className:"col"},c.a.createElement(F,{title:"\u672c\u6708\u6536\u5165",categoryData:l}))))))}}]),t}(c.a.Component),H=Object(M.a)(P(U)),Q=function(e){function t(){var e,a;Object(d.a)(this,t);for(var n=arguments.length,c=new Array(n),r=0;r<n;r++)c[r]=arguments[r];return(a=Object(f.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(c)))).selectCategory=function(e,t){e.preventDefault(),a.props.onSelectCategory(t)},a}return Object(g.a)(t,e),Object(p.a)(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.categories,n=t.selectedCategory,r=n&&n.id;return c.a.createElement("div",{className:"category-select-com"},c.a.createElement("div",{className:"row"},a.map(function(t,a){var n=r===t.id?"#007bff":"#ccc",o=r===t.id?"category-item col-2 active":"category-item col-2";return c.a.createElement("a",{className:o,key:a,href:"#",style:{textDecoration:"none"},onClick:function(a){e.selectCategory(a,t)}},c.a.createElement(D.a,{className:"rounded-circle",fontSize:"50px",color:"#fff",icon:t.iconName,style:{backgroundColor:n,padding:"8px"}}),c.a.createElement("p",{style:{color:n}},t.name))})))}}]),t}(c.a.Component),X=function(e){function t(e){var a;return Object(d.a)(this,t),(a=Object(f.a)(this,Object(h.a)(t).call(this,e))).submitForm=function(e){var t=a.props,n=t.item,c=t.onFormSubmit,r=!!n,o=1*a.priceInput.value.trim(),s=a.titleInput.value.trim(),l=a.dateInput.value.trim();o&&l&&s?(o<0?a.setState({validatePass:!1,errorMessage:"\u91d1\u989d\u6570\u5b57\u5fc5\u987b\u5927\u4e8e0"}):O(l)?a.setState({validatePass:!0,errorMessage:""}):a.setState({validatePass:!1,errorMessage:"\u8bf7\u586b\u5199\u6b63\u786e\u7684\u65e5\u671f\u683c\u5f0f"}),console.log(s,r),c(r?Object(i.a)({},n,{title:s,price:o,date:l}):{title:s,price:o,date:l},r)):a.setState({validatePass:!1,errorMessage:"\u8bf7\u8f93\u5165\u6240\u6709\u5fc5\u9009\u9879"}),e.preventDefault()},a.state={validatePass:!0,errorMessage:""},a}return Object(g.a)(t,e),Object(p.a)(t,[{key:"render",value:function(){var e=this,t=this.props.item?this.props.item:{},a=t.title,n=t.price,r=t.date;return c.a.createElement("form",{className:"price-form-com p-0",onSubmit:function(t){e.submitForm(t)},noValidate:!0},c.a.createElement("div",{className:"form-group text-left"},c.a.createElement("label",{className:"col-2 col-form-label px-0",htmlFor:"inputTitle"},"\u6807\u9898\uff1a"),c.a.createElement("input",{type:"text",className:"form-control",id:"inputTitle",defaultValue:a,ref:function(t){e.titleInput=t},placeholder:"\u8bf7\u8f93\u5165\u6807\u9898"})),c.a.createElement("div",{className:"form-group text-left"},c.a.createElement("label",{className:"col-2 col-form-label px-0",htmlFor:"inputPrice"},"\u91d1\u989d\uff1a"),c.a.createElement("input",{type:"number",className:"form-control",defaultValue:n,id:"inputPrice",ref:function(t){e.priceInput=t},placeholder:"\u8bf7\u8f93\u5165\u91d1\u989d"})),c.a.createElement("div",{className:"form-group text-left"},c.a.createElement("label",{className:"col-2 col-form-label px-0",htmlFor:"inputDate"},"\u65e5\u671f\uff1a"),c.a.createElement("input",{type:"date",className:"form-control",id:"inputDate",defaultValue:r,ref:function(t){e.dateInput=t},placeholder:"\u8bf7\u8f93\u5165\u65e5\u671f"})),c.a.createElement("div",{className:"row mt-4"},c.a.createElement("div",{className:"col-2 text-left pr-0"},c.a.createElement("button",{type:"submit",className:"btn btn-primary"},"\u63d0\u4ea4")),c.a.createElement("div",{className:"col-2 text-left pl-0"},c.a.createElement("button",{className:"btn btn-secondary",onClick:this.props.onCancelSubmit},"\u53d6\u6d88")),!this.state.validatePass&&c.a.createElement("div",{className:"alert alert-danger mt-5",role:"alert"},this.state.errorMessage)))}}]),t}(c.a.Component),Z=[y,"income"],ee=function(e){function t(e){var a;return Object(d.a)(this,t),(a=Object(f.a)(this,Object(h.a)(t).call(this,e))).tabChange=function(e){a.setState({selectedTab:Z[e]})},a.cancelSubmit=function(){a.props.history.push("/")},a.formSubmit=function(e,t){t?(a.props.actions.updateItem(e,a.state.selectedCategory.id),a.props.history.push("/")):null===a.state.selectedCategory?a.setState({validePass:!1,errorMessage:"\u8bf7\u9009\u62e9\u8d26\u76ee\u7c7b\u578b"}):(a.props.actions.createItem(e,a.state.selectedCategory.id),a.props.history.push("/"),console.log(e))},a.selectCategory=function(e){a.setState({selectedCategory:e})},a.state={selectedTab:y,selectedCategory:null,editItem:{},validePass:!0,errorMessage:""},a}return Object(g.a)(t,e),Object(p.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=this.props.match.params.id;this.props.actions.getEditData(t).then(function(a){var n=a.editItem,c=a.categories;e.setState({selectedTab:t&&n?c[n.cid].type:y,selectedCategory:t&&n?c[n.cid]:null,editItem:n})})}},{key:"render",value:function(){var e=this,t=this.props.data,a=t.items,n=t.categories,r=this.props.match.params.id,o=r&&a[r]?a[r]:this.state.editItem,i=Z.findIndex(function(t){return t===e.state.selectedTab}),s=Object.keys(n).filter(function(t){return n[t].type===e.state.selectedTab}).map(function(e){return n[e]});return c.a.createElement("div",{className:"create-page rounded",style:{background:"#fff"}},c.a.createElement(W,{activeIndex:i,onTabChange:this.tabChange},c.a.createElement(J,null,"\u652f\u51fa"),c.a.createElement(J,null,"\u6536\u5165")),c.a.createElement(Q,{categories:s,onSelectCategory:this.selectCategory,selectedCategory:this.state.selectedCategory}),c.a.createElement(X,{onFormSubmit:this.formSubmit,onCancelSubmit:this.cancelSubmit,item:o}),!this.state.validePass&&c.a.createElement("div",{className:"alert alert-danger mt-5",role:"alert"},this.state.errorMessage))}}]),t}(c.a.Component),te=Object(M.a)(P(ee)),ae=c.a.createContext(),ne=function(e){function t(e){var a;Object(d.a)(this,t),(a=Object(f.a)(this,Object(h.a)(t).call(this,e))).state={items:{},categories:{},isLoading:!1,currentDate:C()};var n=function(e){return function(){return a.setState({isLoading:!0}),e.apply(void 0,arguments)}};return a.actions={getInitalData:n(function(){var e=a.state.currentDate,t="/items?monthCategory=".concat(e.year,"-").concat(e.month,"&_sort=timestamp&_order=desc"),n=[S.a.get("/categories"),S.a.get(t)];Promise.all(n).then(function(e){var t=Object(u.a)(e,2),n=t[0],c=t[1];a.setState({items:k(c.data),categories:k(n.data),isLoading:!1})})}),getEditData:n(function(){var e=Object(m.a)(l.a.mark(function e(t){var n,c,r,o,i,s,m,d,p,f,h,g;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.state,c=n.items,r=n.categories,o=[],0===Object.keys(r).length&&o.push(S.a.get("/categories")),i=Object.keys(c).indexOf(t)>-1,t&&!i&&(s="/items/".concat(t),o.push(S.a.get(s))),e.next=7,Promise.all(o);case 7:return m=e.sent,d=Object(u.a)(m,2),p=d[0],f=d[1],h=p?k(p.data):r,g=f?f.data:c[t],a.setState({categories:h,isLoading:!1}),e.abrupt("return",{categories:h,editItem:g});case 15:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),deleteItem:n(function(e){S.a.delete("/items/".concat(e.id)).then(function(){delete a.state.items[e.id],a.setState({items:a.state.items,isLoading:!1})})}),createItem:function(e,t){var n=j(),c=C(e.date);e.monthCategory="".concat(c.year,"-").concat(c.month),e.timestamp=new Date(e.date).getTime();var r=Object(i.a)({},e,{id:n,cid:t});S.a.post("/items",r),a.actions.selectNewDate(c.year,c.month)},selectNewDate:n(function(e,t){var n="/items?monthCategory=".concat(e,"-").concat(t,"&_sort=timestamp&_order=desc");S.a.get(n).then(function(n){a.setState({items:k(n.data),currentDate:{year:e,month:t},isLoading:!1})})}),updateItem:function(e,t){var n=Object(i.a)({},e,{cid:t,timestamp:new Date(e.date).getTime()});S.a.patch("/items/".concat(e.id),n);var c=C(e.date);a.actions.selectNewDate(c.year,c.month)}},a}return Object(g.a)(t,e),Object(p.a)(t,[{key:"render",value:function(){return c.a.createElement(ae.Provider,{value:{state:this.state,actions:this.actions}},c.a.createElement(v.a,null,c.a.createElement("div",{className:"container px-3 pb-3"},c.a.createElement("div",{className:"App"},c.a.createElement(b.a,{path:"/",exact:!0,component:H}),c.a.createElement(b.a,{path:"/create",component:te}),c.a.createElement(b.a,{path:"/edit/:id",component:te})))))}}]),t}(n.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));S.a.get("/items").then(function(e){});S.a.post("/items",{title:"\u8d85\u5e02\u4e70\u6c34\u679c",price:100,date:"2018-12-04",timestamp:15438816e5,id:"_j0z9no9oj",cid:"4"}).then(function(e){}),o.a.render(c.a.createElement(ne,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[204,1,2]]]);
//# sourceMappingURL=main.0a6f0daf.chunk.js.map